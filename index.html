<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
	<link rel="stylesheet" href="index.css" />
	<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<style>
		#mapid{
		height : 100%;
		width : 100%;
		}
	</style>
</head>
 <body>
	<div id="mapid"></div>
	<script>
        var map = L.map('mapid').setView([47.48, -0.55], 13);

        var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
            attribution: '(c) <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        });
        map.addLayer(osmLayer);

		// 0: important places, 1: schools and universities, 2: ATM, 3: commerces, 4: Bars, 5: Gare, 6: Sports, 7: Park

		let iconArray = [
			L.icon({
				iconUrl: 'icons/important.png',
				iconSize: [32, 41],
				iconAnchor: [16, 41]
			}),
			L.icon({
				iconUrl: 'icons/univ.png',
				iconSize: [32, 41],
				iconAnchor: [16, 41]
			}),
			L.icon({
				iconUrl: 'icons/atm.png',
				iconSize: [32, 41],
				iconAnchor: [16, 41]
			}),
			L.icon({
				iconUrl: 'icons/shops.png',
				iconSize: [32, 41],
				iconAnchor: [16, 41]
			}),
			L.icon({
				iconUrl: 'icons/univ.png',
				iconSize: [32, 41],
				iconAnchor: [16, 41]
			}),
			L.icon({
				iconUrl: 'icons/univ.png',
				iconSize: [32, 41],
				iconAnchor: [16, 41]
			}),
			L.icon({
				iconUrl: 'icons/univ.png',
				iconSize: [32, 41],
				iconAnchor: [16, 41]
			}),
			L.icon({
				iconUrl: 'icons/univ.png',
				iconSize: [32, 41],
				iconAnchor: [16, 41]
			})
		]
		
		let LayerID = 0;

		let importUmap = $.getJSON("test.umap", function(readData) {
			readData.layers.forEach(dataPoi => {
				let useIcon;
				if(iconArray[LayerID] != undefined) {
					useIcon = iconArray[LayerID];
				}
				else {
					useIcon = iconArray[0];
				}
				L.geoJson(dataPoi,{
					pointToLayer: function(feature,latlng){
						var marker = L.marker(latlng,{icon: useIcon});					
						return marker;
					},
					onEachFeature: function(feature, layer) {
						layer.bindPopup('<h1>'+feature.properties.name+'</h1><hr><br>'
									+ feature.properties.description 
									);
					}
				}).addTo(map);
				LayerID++;
			});
		});

		map.locate({setView: true, maxZoom: 16});
		function onLocationFound(e) {
    var radius = e.accuracy;

    L.marker(e.latlng).addTo(map)
        .bindPopup("You are within " + radius + " meters from this point").openPopup();

    L.circle(e.latlng, radius).addTo(map);
}

map.on('locationfound', onLocationFound);
function onLocationError(e) {
    alert(e.message);
}

map.on('locationerror', onLocationError);
	</script>
</body>
</html>
